{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { DataService } from '../data.service';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { callWithSnackBar } from '../util';\nimport { TasksService } from '../tasks.service';\nimport { Base } from '../base';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../data.service\";\nimport * as i2 from \"@angular/material/snack-bar\";\nimport * as i3 from \"../tasks.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/material/icon\";\nimport * as i6 from \"@angular/material/button\";\nimport * as i7 from \"@angular/material/tooltip\";\nimport * as i8 from \"@angular/material/progress-spinner\";\nimport * as i9 from \"../user-selector/user-selector.component\";\n\nfunction TeamSummaryComponent_ng_template_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-spinner\");\n  }\n}\n\nfunction TeamSummaryComponent_div_11_div_4_img_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 14);\n  }\n\n  if (rf & 2) {\n    const user_r5 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵproperty(\"src\", user_r5.picture, i0.ɵɵsanitizeUrl);\n  }\n}\n\nfunction TeamSummaryComponent_div_11_div_4_div_6_li_4_ul_2_button_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 19);\n    i0.ɵɵlistener(\"click\", function TeamSummaryComponent_div_11_div_4_div_6_li_4_ul_2_button_2_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const task_r12 = i0.ɵɵnextContext().$implicit;\n      const ctx_r14 = i0.ɵɵnextContext(5);\n      return i0.ɵɵresetView(ctx_r14.unassignTask(task_r12));\n    });\n    i0.ɵɵelement(1, \"mat-icon\", 20);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction TeamSummaryComponent_div_11_div_4_div_6_li_4_ul_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\", 17)(1, \"li\");\n    i0.ɵɵtemplate(2, TeamSummaryComponent_div_11_div_4_div_6_li_4_ul_2_button_2_Template, 2, 0, \"button\", 18);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const task_r12 = ctx.$implicit;\n    const ctx_r11 = i0.ɵɵnextContext(5);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r11.editable && ctx_r11.permission(task_r12, \"update\"));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate3(\" Task #\", task_r12.id, \" - \", task_r12.title, \" - \", task_r12.estimate, \" hours \");\n  }\n}\n\nfunction TeamSummaryComponent_div_11_div_4_div_6_li_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, TeamSummaryComponent_div_11_div_4_div_6_li_4_ul_2_Template, 4, 4, \"ul\", 16);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const issue_r10 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\"Issue #\", issue_r10.id, \" - \", issue_r10.title, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", issue_r10.assigned_tasks);\n  }\n}\n\nfunction TeamSummaryComponent_div_11_div_4_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\");\n    i0.ɵɵtext(2, \"Assigned Work:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ul\");\n    i0.ɵɵtemplate(4, TeamSummaryComponent_div_11_div_4_div_6_li_4_Template, 3, 3, \"li\", 15);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const user_r5 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", user_r5.work.assigned_issues);\n  }\n}\n\nfunction TeamSummaryComponent_div_11_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10)(1, \"div\");\n    i0.ɵɵtemplate(2, TeamSummaryComponent_div_11_div_4_img_2_Template, 1, 1, \"img\", 11);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 12);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, TeamSummaryComponent_div_11_div_4_div_6_Template, 5, 1, \"div\", 13);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const user_r5 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", user_r5.picture);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", user_r5.displayName || user_r5.first_name + \" \" + user_r5.last_name, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Total estimated work: \", user_r5.work.work, \" hours\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", user_r5.work.assigned_issues.length > 0);\n  }\n}\n\nfunction TeamSummaryComponent_div_11_div_6_li_4_li_3_sb_user_selector_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r25 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"sb-user-selector\", 25);\n    i0.ɵɵlistener(\"userSelected\", function TeamSummaryComponent_div_11_div_6_li_4_li_3_sb_user_selector_3_Template_sb_user_selector_userSelected_0_listener($event) {\n      i0.ɵɵrestoreView(_r25);\n      const task_r21 = i0.ɵɵnextContext().$implicit;\n      const ctx_r23 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r23.assignTask(task_r21, $event));\n    });\n    i0.ɵɵpipe(1, \"async\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const task_r21 = i0.ɵɵnextContext().$implicit;\n    const ctx_r22 = i0.ɵɵnextContext(4);\n    let tmp_0_0;\n    i0.ɵɵproperty(\"team\", (tmp_0_0 = i0.ɵɵpipeBind1(1, 2, ctx_r22.teamSummary)) == null ? null : tmp_0_0.team.members)(\"assignee\", task_r21.assignee);\n  }\n}\n\nfunction TeamSummaryComponent_div_11_div_6_li_4_li_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\")(1, \"span\", 23);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, TeamSummaryComponent_div_11_div_6_li_4_li_3_sb_user_selector_3_Template, 2, 4, \"sb-user-selector\", 24);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const task_r21 = ctx.$implicit;\n    const ctx_r20 = i0.ɵɵnextContext(4);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate3(\"Task #\", task_r21.id, \" - \", task_r21.title, \" - \", task_r21.estimate, \" hours\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r20.editable && ctx_r20.permission(task_r21, \"update\"));\n  }\n}\n\nfunction TeamSummaryComponent_div_11_div_6_li_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementStart(2, \"ul\");\n    i0.ɵɵtemplate(3, TeamSummaryComponent_div_11_div_6_li_4_li_3_Template, 4, 4, \"li\", 15);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const issue_r19 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" Issue #\", issue_r19.id, \" - \", issue_r19.title, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", issue_r19.unassigned_tasks);\n  }\n}\n\nfunction TeamSummaryComponent_div_11_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21)(1, \"span\", 22);\n    i0.ɵɵtext(2, \"Unassigned Work:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ul\");\n    i0.ɵɵtemplate(4, TeamSummaryComponent_div_11_div_6_li_4_Template, 4, 3, \"li\", 15);\n    i0.ɵɵpipe(5, \"async\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(5, 1, ctx_r4.teamSummary).team.unassignedWork.unassigned_issues);\n  }\n}\n\nfunction TeamSummaryComponent_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 7);\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"async\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, TeamSummaryComponent_div_11_div_4_Template, 7, 4, \"div\", 8);\n    i0.ɵɵpipe(5, \"async\");\n    i0.ɵɵtemplate(6, TeamSummaryComponent_div_11_div_6_Template, 6, 3, \"div\", 9);\n    i0.ɵɵpipe(7, \"async\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" Total Unassigned Work: \", i0.ɵɵpipeBind1(3, 3, ctx_r2.teamSummary).team.unassignedWork.total_work, \" hours \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(5, 5, ctx_r2.teamSummary).team.members);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(7, 7, ctx_r2.teamSummary).team.unassignedWork.unassigned_issues.length > 0);\n  }\n}\n\nexport let TeamSummaryComponent = /*#__PURE__*/(() => {\n  class TeamSummaryComponent extends Base {\n    constructor(dataService, snackBar, tasksService) {\n      super();\n      this.dataService = dataService;\n      this.snackBar = snackBar;\n      this.tasksService = tasksService;\n      this.close = new EventEmitter();\n    }\n\n    ngOnInit() {}\n\n    loadSummary() {\n      this.dataService.load(`sprints/${this.sprint.id}/team_summary`, [`sprints/${this.sprint.id}/team_summary`]);\n      this.teamSummary = this.dataService.values[`sprints/${this.sprint.id}/team_summary`];\n    }\n\n    unloadSummary() {\n      this.dataService.unload(`sprints/${this.sprint.id}/team_summary`, [`sprints/${this.sprint.id}/team_summary`]);\n    }\n\n    set sprint(value) {\n      if (this._sprint) {\n        this.unloadSummary();\n      }\n\n      this._sprint = value;\n      this.loadSummary();\n    }\n\n    get sprint() {\n      return this._sprint;\n    }\n\n    ngOnDestroy() {\n      // we do a fast unload because we want fresh data every time we load the dialog.\n      this.dataService.fastUnload(`sprints/${this.sprint.id}/team_summary`);\n    }\n\n    unassignTask(task) {\n      callWithSnackBar(this.snackBar, this.tasksService.assignTask(task.id, -1), [\"Unassigning task...\", \"Unassigned task\", \"Error unassigning task\"]);\n    }\n\n    assignTask(task, user) {\n      callWithSnackBar(this.snackBar, this.tasksService.assignTask(task.id, user.id), [\"Assigning task...\", \"Assigned task\", \"Error assigning task\"]);\n    }\n\n    okay() {\n      this.close.emit();\n    }\n\n  }\n\n  TeamSummaryComponent.ɵfac = function TeamSummaryComponent_Factory(t) {\n    return new (t || TeamSummaryComponent)(i0.ɵɵdirectiveInject(i1.DataService), i0.ɵɵdirectiveInject(i2.MatSnackBar), i0.ɵɵdirectiveInject(i3.TasksService));\n  };\n\n  TeamSummaryComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: TeamSummaryComponent,\n    selectors: [[\"sb-team-summary\"]],\n    inputs: {\n      project: \"project\",\n      editable: \"editable\",\n      sprint: \"sprint\"\n    },\n    outputs: {\n      close: \"close\"\n    },\n    features: [i0.ɵɵInheritDefinitionFeature],\n    decls: 13,\n    vars: 6,\n    consts: [[\"progressSpinner\", \"\"], [1, \"banner-text\", \"p-2\", \"col-10\", \"sprint-banner\"], [1, \"sprint-number\"], [1, \"sprint-title\"], [1, \"col-12\", \"text-right\", \"p-0\"], [\"mat-button\", \"\", 1, \"done-button\", \"icon-button\", 3, \"click\"], [4, \"ngIf\", \"ngIfElse\"], [1, \"total-unassigned-work\"], [\"class\", \"user-summary-card mb-3\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"unassigned-work-card\", 4, \"ngIf\"], [1, \"user-summary-card\", \"mb-3\"], [\"class\", \"user-picture\", \"alt\", \"user\", 3, \"src\", 4, \"ngIf\"], [1, \"work-estimate\"], [4, \"ngIf\"], [\"alt\", \"user\", 1, \"user-picture\", 3, \"src\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"row\", 4, \"ngFor\", \"ngForOf\"], [1, \"row\"], [\"class\", \"sb-button small-button\", 3, \"click\", 4, \"ngIf\"], [1, \"sb-button\", \"small-button\", 3, \"click\"], [\"fontSet\", \"fas\", \"fontIcon\", \"fa-times-circle\", \"matTooltip\", \"Unassign\", 1, \"sb-icon\"], [1, \"unassigned-work-card\"], [1, \"unassigned-work-title\"], [1, \"col-4\"], [\"class\", \"col-8\", 3, \"team\", \"assignee\", \"userSelected\", 4, \"ngIf\"], [1, \"col-8\", 3, \"team\", \"assignee\", \"userSelected\"]],\n    template: function TeamSummaryComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, TeamSummaryComponent_ng_template_0_Template, 1, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementStart(2, \"div\")(3, \"div\", 1)(4, \"span\", 2);\n        i0.ɵɵtext(5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"span\", 3);\n        i0.ɵɵtext(7);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(8, \"div\", 4)(9, \"button\", 5);\n        i0.ɵɵlistener(\"click\", function TeamSummaryComponent_Template_button_click_9_listener() {\n          return ctx.okay();\n        });\n        i0.ɵɵtext(10, \"Done\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(11, TeamSummaryComponent_div_11_Template, 8, 9, \"div\", 6);\n        i0.ɵɵpipe(12, \"async\");\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        const _r0 = i0.ɵɵreference(1);\n\n        i0.ɵɵadvance(5);\n        i0.ɵɵtextInterpolate1(\"#\", ctx.sprint.id, \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate(ctx.sprint.title);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", ctx.project && ctx.project.team && i0.ɵɵpipeBind1(12, 4, ctx.teamSummary))(\"ngIfElse\", _r0);\n      }\n    },\n    dependencies: [i4.NgForOf, i4.NgIf, i5.MatIcon, i6.MatButton, i7.MatTooltip, i8.MatSpinner, i9.UserSelectorComponent, i4.AsyncPipe],\n    styles: [\".user-summary-card[_ngcontent-%COMP%]{margin:3px}.assigned-task-listing[_ngcontent-%COMP%]{padding-left:12px}.work-estimate[_ngcontent-%COMP%], .unassigned-work-title[_ngcontent-%COMP%]{font-weight:bolder}.unassigned-work-card[_ngcontent-%COMP%]{border-style:solid;border-width:1px;border-color:var(--card-border);border-radius:3px;padding:2px}.done-button[_ngcontent-%COMP%]{background-color:var(--go-button-background);color:var(--on-go-button-background);border-radius:1px;border-width:2px;border-color:var(--button-border);border-style:solid;box-shadow:2px 2px var(--button-shadow);margin-top:3px}.total-unassigned-work[_ngcontent-%COMP%]{font-weight:bolder;padding-bottom:3px;text-decoration:underline}\"]\n  });\n  return TeamSummaryComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}