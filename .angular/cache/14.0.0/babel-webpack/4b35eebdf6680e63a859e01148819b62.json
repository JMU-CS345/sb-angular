{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { UiStateService } from '../ui-state.service';\nimport { Base } from '../base';\nimport { StartSprintComponent } from '../start-sprint/start-sprint.component';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { callWithSnackBar } from '../util';\nimport { SprintsService } from '../sprints.service';\nimport { TeamSummaryComponent } from '../team-summary/team-summary.component';\nimport { never } from 'rxjs';\nimport { DataService } from '../data.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../ui-state.service\";\nimport * as i2 from \"@angular/material/dialog\";\nimport * as i3 from \"@angular/material/snack-bar\";\nimport * as i4 from \"../sprints.service\";\nimport * as i5 from \"../data.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/material/icon\";\nimport * as i8 from \"@angular/material/button\";\nimport * as i9 from \"@angular/material/tooltip\";\nimport * as i10 from \"@angular/material/progress-spinner\";\nimport * as i11 from \"../sprint-issue-list/sprint-issue-list.component\";\nimport * as i12 from \"../comment-display/comment-display.component\";\nimport * as i13 from \"../comment-entry/comment-entry.component\";\n\nfunction SprintCardComponent_ng_template_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-spinner\");\n  }\n}\n\nfunction SprintCardComponent_div_2_button_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"button\", 13)(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"expand_more\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction SprintCardComponent_div_2_button_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"button\", 13)(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"expand_less\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction SprintCardComponent_div_2_button_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 14);\n    i0.ɵɵlistener(\"click\", function SprintCardComponent_div_2_button_11_Template_button_click_0_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r9.onStartSprint($event));\n    });\n    i0.ɵɵelement(1, \"mat-icon\", 15);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction SprintCardComponent_div_2_button_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function SprintCardComponent_div_2_button_13_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r11.suspendSprint());\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\", 17);\n    i0.ɵɵtext(2, \"pause_circle\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction SprintCardComponent_div_2_mat_icon_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-icon\", 18);\n    i0.ɵɵtext(1, \"directions_run\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction SprintCardComponent_div_2_div_15_sb_comment_display_39_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"sb-comment-display\", 35);\n  }\n\n  if (rf & 2) {\n    const comment_r14 = ctx.$implicit;\n    i0.ɵɵproperty(\"comment\", comment_r14);\n  }\n}\n\nfunction SprintCardComponent_div_2_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 19)(1, \"div\", 20)(2, \"div\", 21);\n    i0.ɵɵtext(3, \"Goal: \");\n    i0.ɵɵelementStart(4, \"span\", 22);\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"async\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(7, \"div\", 20)(8, \"div\", 23);\n    i0.ɵɵtext(9, \" State: \");\n    i0.ɵɵelementStart(10, \"span\", 22);\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"div\", 23);\n    i0.ɵɵtext(13, \" Total Estimate: \");\n    i0.ɵɵelementStart(14, \"span\", 22);\n    i0.ɵɵtext(15);\n    i0.ɵɵpipe(16, \"async\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(17, \"div\", 20)(18, \"div\", 21);\n    i0.ɵɵtext(19, \"Total Work: \");\n    i0.ɵɵelementStart(20, \"span\", 22);\n    i0.ɵɵtext(21);\n    i0.ɵɵpipe(22, \"async\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(23, \"div\", 20)(24, \"div\", 24)(25, \"a\", 25);\n    i0.ɵɵlistener(\"click\", function SprintCardComponent_div_2_div_15_Template_a_click_25_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r15 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r15.showSummary());\n    });\n    i0.ɵɵelementStart(26, \"mat-icon\", 26);\n    i0.ɵɵtext(27, \"people\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(28, \"span\", 27);\n    i0.ɵɵtext(29, \"Team Summary\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(30, \"div\", 20)(31, \"div\", 24);\n    i0.ɵɵtext(32);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(33, \"div\", 28)(34, \"sb-sprint-issue-list\", 29);\n    i0.ɵɵlistener(\"transfer\", function SprintCardComponent_div_2_div_15_Template_sb_sprint_issue_list_transfer_34_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r17 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r17.onTransfer($event));\n    })(\"issueSelected\", function SprintCardComponent_div_2_div_15_Template_sb_sprint_issue_list_issueSelected_34_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r18 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r18.onIssueSelected($event));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(35, \"div\", 30)(36, \"div\", 31);\n    i0.ɵɵtext(37, \"Comments\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(38, \"div\", 32);\n    i0.ɵɵtemplate(39, SprintCardComponent_div_2_div_15_sb_comment_display_39_Template, 1, 1, \"sb-comment-display\", 33);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(40, \"sb-comment-entry\", 34);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r8 = i0.ɵɵnextContext(2);\n    let tmp_0_0;\n    let tmp_2_0;\n    let tmp_3_0;\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate((tmp_0_0 = i0.ɵɵpipeBind1(6, 9, ctx_r8.sprint$)) == null ? null : tmp_0_0.goal);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(ctx_r8.sprint.id == ctx_r8.sprint.project.current_sprint_id ? \"Active\" : ctx_r8.sprint.started ? ctx_r8.sprint.completed ? \"Completed\" : \"Suspended\" : \"Pending\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"\", (tmp_2_0 = i0.ɵɵpipeBind1(16, 11, ctx_r8.sprint$)) == null ? null : tmp_2_0.total_estimate, \" points\");\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate1(\"\", (tmp_3_0 = i0.ɵɵpipeBind1(22, 13, ctx_r8.sprint$)) == null ? null : tmp_3_0.total_work, \" hours\");\n    i0.ɵɵadvance(11);\n    i0.ɵɵtextInterpolate(ctx_r8.sprint.description);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"sprint\", ctx_r8.sprint)(\"editable\", ctx_r8.editable && ctx_r8.permission(ctx_r8.sprint, \"update\"));\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r8.sprint.comments);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"sprintId\", ctx_r8.sprint.id);\n  }\n}\n\nfunction SprintCardComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"div\", 3)(2, \"span\", 4);\n    i0.ɵɵlistener(\"click\", function SprintCardComponent_div_2_Template_span_click_2_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r19 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r19.toggleExpanded());\n    });\n    i0.ɵɵtemplate(3, SprintCardComponent_div_2_button_3_Template, 3, 0, \"button\", 5);\n    i0.ɵɵtemplate(4, SprintCardComponent_div_2_button_4_Template, 3, 0, \"button\", 5);\n    i0.ɵɵelementStart(5, \"button\", 6);\n    i0.ɵɵlistener(\"click\", function SprintCardComponent_div_2_Template_button_click_5_listener($event) {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r21 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r21.onViewSprint($event));\n    });\n    i0.ɵɵelement(6, \"mat-icon\", 7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"async\");\n    i0.ɵɵpipe(9, \"async\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"span\", 8);\n    i0.ɵɵtemplate(11, SprintCardComponent_div_2_button_11_Template, 2, 0, \"button\", 9);\n    i0.ɵɵelementStart(12, \"span\");\n    i0.ɵɵtemplate(13, SprintCardComponent_div_2_button_13_Template, 3, 0, \"button\", 10);\n    i0.ɵɵtemplate(14, SprintCardComponent_div_2_mat_icon_14_Template, 2, 0, \"mat-icon\", 11);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵtemplate(15, SprintCardComponent_div_2_div_15_Template, 41, 15, \"div\", 12);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    let tmp_2_0;\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r2.expanded);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.expanded);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate2(\" \", (tmp_2_0 = i0.ɵɵpipeBind1(8, 8, ctx_r2.sprint$)) == null ? null : tmp_2_0.id, \" - \", (tmp_2_0 = i0.ɵɵpipeBind1(9, 10, ctx_r2.sprint$)) == null ? null : tmp_2_0.title, \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.showStartButton);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.permission(ctx_r2.sprint, \"suspend\") && ctx_r2.sprint.id == ctx_r2.sprint.project.current_sprint_id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r2.permission(ctx_r2.sprint, \"suspend\") && ctx_r2.sprint.id == ctx_r2.sprint.project.current_sprint_id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.expanded);\n  }\n}\n\nexport let SprintCardComponent = /*#__PURE__*/(() => {\n  class SprintCardComponent extends Base {\n    constructor(uiState, dialog, snackBar, sprintsService, dataService) {\n      super();\n      this.uiState = uiState;\n      this.dialog = dialog;\n      this.snackBar = snackBar;\n      this.sprintsService = sprintsService;\n      this.dataService = dataService;\n      this.transfer = new EventEmitter();\n      this.selected = new EventEmitter();\n      this.start = new EventEmitter();\n      this.issueSelected = new EventEmitter();\n      this.expanded = false;\n    }\n\n    ngOnInit() {}\n\n    set sprint(value) {\n      this._sprint = value;\n\n      if (value) {\n        this.expanded = this.uiState.isExpanded(\"sprint/\" + this.sprint.id);\n        this.updateSprintAsync();\n      } else {\n        this.clearSprintAsync();\n      }\n    }\n\n    get sprint() {\n      return this._sprint;\n    }\n\n    updateSprintAsync() {\n      if (this.unloader) {\n        this.unloader();\n      }\n\n      this.dataService.load(`sprints/${this.sprint.id}`, [`sprints/${this.sprint.id}`, `sprints/${this.sprint.id}/issues`]);\n      this.sprint$ = this.dataService.values[`sprints/${this.sprint.id}`];\n\n      this.unloader = () => {\n        this.dataService.unload(`sprints/${this.sprint.id}`, [`sprints/${this.sprint.id}`, `sprints/${this.sprint.id}/issues`]);\n      };\n    }\n\n    clearSprintAsync() {\n      if (this.unloader) {\n        this.unloader();\n      }\n\n      this.sprint$ = never(); // if no sprint set, the Observable should never complete.\n    }\n\n    ngOnDestroy() {\n      if (this.unloader) {\n        this.unloader();\n      }\n    }\n\n    toggleExpanded() {\n      this.expanded = !this.expanded;\n      this.uiState.setExpanded(\"sprint/\" + this.sprint.id, this.expanded);\n    }\n\n    onTransfer(transferData) {\n      this.transfer.emit(transferData);\n    }\n\n    onViewSprint(event) {\n      event.stopPropagation();\n      this.selected.emit(this.sprint);\n    }\n\n    onStartSprint(event) {\n      let data = {\n        sprint: this.sprint,\n        reset: false\n      };\n      const dialogRef = this.dialog.open(StartSprintComponent, {\n        maxWidth: \"600px\",\n        data: data\n      }); // listen to response\n\n      dialogRef.afterClosed().subscribe(dialogResult => {\n        if (dialogResult) {\n          this.start.emit(data);\n          this.dataService.forceRefresh(`projects/${this.sprint.project.id}`);\n        }\n      }); // this.start.emit(this.sprint);\n    }\n\n    suspendSprint() {\n      callWithSnackBar(this.snackBar, this.sprintsService.suspendSprint(this.sprint), ['Suspending sprint...', 'Sprint suspended', 'Error suspending sprint']);\n    }\n\n    onIssueSelected(issue) {\n      console.log(\"FOOOOO\");\n      this.issueSelected.emit(issue);\n    }\n\n    showSummary() {\n      let data = {\n        sprint: this.sprint,\n        project: this.project,\n        editable: this.editable\n      };\n      const dialogRef = this.dialog.open(TeamSummaryComponent, {\n        width: \"90%\",\n        maxWidth: \"800px\",\n        data: data\n      }); // listen to response\n\n      dialogRef.afterClosed().subscribe(dialogResult => {});\n    }\n\n  }\n\n  SprintCardComponent.ɵfac = function SprintCardComponent_Factory(t) {\n    return new (t || SprintCardComponent)(i0.ɵɵdirectiveInject(i1.UiStateService), i0.ɵɵdirectiveInject(i2.MatDialog), i0.ɵɵdirectiveInject(i3.MatSnackBar), i0.ɵɵdirectiveInject(i4.SprintsService), i0.ɵɵdirectiveInject(i5.DataService));\n  };\n\n  SprintCardComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: SprintCardComponent,\n    selectors: [[\"app-sprint-card\"]],\n    inputs: {\n      project: \"project\",\n      showStartButton: \"showStartButton\",\n      editable: \"editable\",\n      sprint: \"sprint\"\n    },\n    outputs: {\n      transfer: \"transfer\",\n      selected: \"selected\",\n      start: \"start\",\n      issueSelected: \"issueSelected\"\n    },\n    features: [i0.ɵɵInheritDefinitionFeature],\n    decls: 3,\n    vars: 2,\n    consts: [[\"progressSpinner\", \"\"], [\"class\", \"px-3\", 4, \"ngIf\", \"ngIfElse\"], [1, \"px-3\"], [1, \"sprint-card\", \"text-truncate\", \"row\"], [1, \"col-10\", \"banner-text\", \"sprint-card-section\", 3, \"click\"], [\"mat-icon-button\", \"\", 4, \"ngIf\"], [\"mat-icon-button\", \"\", \"matTooltip\", \"View Sprint\", 3, \"click\"], [\"fontSet\", \"fas\", \"fontIcon\", \"fa-eye\"], [1, \"col-2\", \"sprint-card-section\"], [\"mat-icon-button\", \"\", \"matTooltip\", \"Start Sprint\", 3, \"click\", 4, \"ngIf\"], [\"mat-icon-button\", \"\", \"color\", \"warn\", \"matTooltip\", \"Suspend Sprint\", 3, \"click\", 4, \"ngIf\"], [\"style\", \"position: relative; top: 6px;\", 4, \"ngIf\"], [\"class\", \"sprint-card-content\", 4, \"ngIf\"], [\"mat-icon-button\", \"\"], [\"mat-icon-button\", \"\", \"matTooltip\", \"Start Sprint\", 3, \"click\"], [\"fontSet\", \"fas\", \"fontIcon\", \"fa-play-circle\", 1, \"play-icon\"], [\"mat-icon-button\", \"\", \"color\", \"warn\", \"matTooltip\", \"Suspend Sprint\", 3, \"click\"], [1, \"pause-icon\"], [2, \"position\", \"relative\", \"top\", \"6px\"], [1, \"sprint-card-content\"], [1, \"sprint-info\", \"row\"], [1, \"col-12\", \"menu-text\"], [1, \"base-text\"], [1, \"col-6\", \"menu-text\"], [1, \"col-12\"], [1, \"sb-link\", 3, \"click\"], [2, \"position\", \"relative\", \"top\", \"4px\"], [1, \"menu-text\", \"team-summary-link\"], [2, \"margin\", \"0px 3px 3px 30px\"], [3, \"sprint\", \"editable\", \"transfer\", \"issueSelected\"], [1, \"mt-3\"], [1, \"banner-text\"], [1, \"comments-display-box\", \"mb-1\"], [3, \"comment\", 4, \"ngFor\", \"ngForOf\"], [3, \"sprintId\"], [3, \"comment\"]],\n    template: function SprintCardComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, SprintCardComponent_ng_template_0_Template, 1, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵtemplate(2, SprintCardComponent_div_2_Template, 16, 12, \"div\", 1);\n      }\n\n      if (rf & 2) {\n        const _r0 = i0.ɵɵreference(1);\n\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.sprint)(\"ngIfElse\", _r0);\n      }\n    },\n    dependencies: [i6.NgForOf, i6.NgIf, i7.MatIcon, i8.MatButton, i9.MatTooltip, i10.MatSpinner, i11.SprintIssueListComponent, i12.CommentDisplayComponent, i13.CommentEntryComponent, i6.AsyncPipe],\n    styles: [\".team-summary-link[_ngcontent-%COMP%]{text-decoration:underline;-webkit-text-decoration-style:dotted;text-decoration-style:dotted}.sprint-card[_ngcontent-%COMP%]{border-radius:1px;border-width:1px;border-color:var(--on-background);border-style:solid}.sprint-card-section[_ngcontent-%COMP%]{background-color:var(--background);font-size:small;cursor:default}.sprint-card-content[_ngcontent-%COMP%]{background-color:var(--background);color:var(--on-background);border-width:1px;border-style:solid;border-color:var(--on-background);margin-bottom:6px}.play-icon[_ngcontent-%COMP%]{color:var(--okay);font-size:x-large}.pause-icon[_ngcontent-%COMP%]{color:var(--warning);font-size:x-large}.sprint-info[_ngcontent-%COMP%]{padding:5px}.comments-display-box[_ngcontent-%COMP%]{background-color:var(--background);border:1px solid var(--on-background);margin:2px}\"]\n  });\n  return SprintCardComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}