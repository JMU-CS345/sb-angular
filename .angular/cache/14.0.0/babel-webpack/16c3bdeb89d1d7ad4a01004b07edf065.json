{"ast":null,"code":"import { QueryList } from '@angular/core';\nimport { Base } from '../base';\nimport { Router } from '@angular/router';\nimport { IssuesService } from '../issues.service';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { callWithSnackBar } from '../util';\nimport { first } from 'rxjs/operators';\nimport { ProjectService } from '../project.service';\nimport { DataService } from '../data.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../issues.service\";\nimport * as i3 from \"@angular/material/snack-bar\";\nimport * as i4 from \"../project.service\";\nimport * as i5 from \"../data.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/material/card\";\nimport * as i8 from \"@angular/material/icon\";\nimport * as i9 from \"@angular/material/button\";\nimport * as i10 from \"@angular/material/tooltip\";\nimport * as i11 from \"@angular/material/progress-spinner\";\nimport * as i12 from \"@angular/cdk/drag-drop\";\nimport * as i13 from \"../issue-detail/issue-detail.component\";\nimport * as i14 from \"../project-frame/project-frame.component\";\nimport * as i15 from \"../issue-form/issue-form.component\";\nimport * as i16 from \"../simple-issues-list/simple-issues-list.component\";\nconst _c0 = [\"createIssue\"];\n\nfunction IssuesViewInnerComponent_ng_template_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-spinner\");\n  }\n}\n\nfunction IssuesViewInnerComponent_app_project_frame_2_div_1_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"button\", 19);\n    i0.ɵɵlistener(\"click\", function IssuesViewInnerComponent_app_project_frame_2_div_1_div_11_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r12 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r12.clearDetail());\n    });\n    i0.ɵɵelementStart(2, \"mat-icon\", 20);\n    i0.ɵɵtext(3, \"arrow_back\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtext(4, \" Issue List \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction IssuesViewInnerComponent_app_project_frame_2_div_1_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\");\n  }\n}\n\nfunction IssuesViewInnerComponent_app_project_frame_2_div_1_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21)(1, \"mat-icon\", 22);\n    i0.ɵɵtext(2, \"edit\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3, \" Edit Issue \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction IssuesViewInnerComponent_app_project_frame_2_div_1_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21)(1, \"mat-icon\", 22);\n    i0.ɵɵtext(2, \"add_circle\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3, \" Create Issue \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction IssuesViewInnerComponent_app_project_frame_2_div_1_div_19_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\")(1, \"app-issue-detail\", 23);\n    i0.ɵɵlistener(\"editIssue\", function IssuesViewInnerComponent_app_project_frame_2_div_1_div_19_div_1_Template_app_issue_detail_editIssue_1_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r15 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r15.mode = \"edit\");\n    })(\"completeIssue\", function IssuesViewInnerComponent_app_project_frame_2_div_1_div_19_div_1_Template_app_issue_detail_completeIssue_1_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r17 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r17.onCompleteIssue($event));\n    });\n    i0.ɵɵpipe(2, \"async\");\n    i0.ɵɵpipe(3, \"async\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r14 = i0.ɵɵnextContext(4);\n    let tmp_3_0;\n    let tmp_4_0;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"showAcceptanceCriteria\", ctx_r14.project.setting_use_acceptance_criteria)(\"showCompletionCheckboxes\", false)(\"issue\", ctx_r14.issue)(\"epics\", (tmp_3_0 = i0.ɵɵpipeBind1(2, 5, ctx_r14.epics$)) == null ? null : tmp_3_0.epics == null ? null : tmp_3_0.epics.list)(\"sprints\", (tmp_4_0 = i0.ɵɵpipeBind1(3, 7, ctx_r14.sprints$)) == null ? null : tmp_4_0.sprints == null ? null : tmp_4_0.sprints.list);\n  }\n}\n\nfunction IssuesViewInnerComponent_app_project_frame_2_div_1_div_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, IssuesViewInnerComponent_app_project_frame_2_div_1_div_19_div_1_Template, 4, 9, \"div\", 15);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", \"show\");\n  }\n}\n\nfunction IssuesViewInnerComponent_app_project_frame_2_div_1_div_20_sb_issue_form_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"sb-issue-form\", 25);\n    i0.ɵɵlistener(\"confirmEdit\", function IssuesViewInnerComponent_app_project_frame_2_div_1_div_20_sb_issue_form_1_Template_sb_issue_form_confirmEdit_0_listener($event) {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r19 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r19.confirmEdit($event));\n    })(\"cancelEdit\", function IssuesViewInnerComponent_app_project_frame_2_div_1_div_20_sb_issue_form_1_Template_sb_issue_form_cancelEdit_0_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r21 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r21.cancelEdit());\n    })(\"deleteIssue\", function IssuesViewInnerComponent_app_project_frame_2_div_1_div_20_sb_issue_form_1_Template_sb_issue_form_deleteIssue_0_listener($event) {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r22 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r22.delete($event));\n    });\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r18 = i0.ɵɵnextContext(4);\n    i0.ɵɵproperty(\"issue\", ctx_r18.issue);\n  }\n}\n\nfunction IssuesViewInnerComponent_app_project_frame_2_div_1_div_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, IssuesViewInnerComponent_app_project_frame_2_div_1_div_20_sb_issue_form_1_Template, 1, 1, \"sb-issue-form\", 24);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", \"edit\");\n  }\n}\n\nfunction IssuesViewInnerComponent_app_project_frame_2_div_1_div_21_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r25 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\")(1, \"sb-issue-form\", 26, 27);\n    i0.ɵɵlistener(\"confirmEdit\", function IssuesViewInnerComponent_app_project_frame_2_div_1_div_21_Template_sb_issue_form_confirmEdit_1_listener($event) {\n      i0.ɵɵrestoreView(_r25);\n      const ctx_r24 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r24.saveNewIssue($event));\n    })(\"cancelEdit\", function IssuesViewInnerComponent_app_project_frame_2_div_1_div_21_Template_sb_issue_form_cancelEdit_1_listener() {\n      i0.ɵɵrestoreView(_r25);\n      const ctx_r26 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r26.cancelEdit());\n    });\n    i0.ɵɵelementEnd()();\n  }\n}\n\nconst _c1 = function (a0) {\n  return {\n    \"large-only\": a0\n  };\n};\n\nfunction IssuesViewInnerComponent_app_project_frame_2_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r28 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 4)(2, \"div\", 5)(3, \"div\", 6)(4, \"div\", 7)(5, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function IssuesViewInnerComponent_app_project_frame_2_div_1_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r28);\n      const ctx_r27 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r27.createIssue());\n    });\n    i0.ɵɵelementStart(6, \"mat-icon\", 9);\n    i0.ɵɵtext(7, \"add_circle\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(8, \" New \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"sb-simple-issues-list\", 10, 11);\n    i0.ɵɵlistener(\"issueSelected\", function IssuesViewInnerComponent_app_project_frame_2_div_1_Template_sb_simple_issues_list_issueSelected_9_listener($event) {\n      i0.ɵɵrestoreView(_r28);\n      const ctx_r29 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r29.showDetail($event));\n    });\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵtemplate(11, IssuesViewInnerComponent_app_project_frame_2_div_1_div_11_Template, 5, 0, \"div\", 12);\n    i0.ɵɵelementStart(12, \"div\", 13)(13, \"div\", 6)(14, \"mat-card-title\", 14);\n    i0.ɵɵtemplate(15, IssuesViewInnerComponent_app_project_frame_2_div_1_div_15_Template, 1, 0, \"div\", 15);\n    i0.ɵɵtemplate(16, IssuesViewInnerComponent_app_project_frame_2_div_1_div_16_Template, 4, 0, \"div\", 16);\n    i0.ɵɵtemplate(17, IssuesViewInnerComponent_app_project_frame_2_div_1_div_17_Template, 4, 0, \"div\", 16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"mat-card-content\", 14);\n    i0.ɵɵtemplate(19, IssuesViewInnerComponent_app_project_frame_2_div_1_div_19_Template, 2, 1, \"div\", 17);\n    i0.ɵɵtemplate(20, IssuesViewInnerComponent_app_project_frame_2_div_1_div_20_Template, 2, 1, \"div\", 15);\n    i0.ɵɵtemplate(21, IssuesViewInnerComponent_app_project_frame_2_div_1_div_21_Template, 3, 0, \"div\", 15);\n    i0.ɵɵelementEnd()()()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(14, _c1, ctx_r3.issue || ctx_r3.mode == \"edit\" || ctx_r3.mode == \"create\"));\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"container\", ctx_r3.project)(\"issues\", ctx_r3.issues)(\"fixed\", !ctx_r3.permission(ctx_r3.project, \"update\"))(\"requestedIssueId\", ctx_r3.requestedIssueId);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.issue);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngSwitch\", ctx_r3.mode);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", \"show\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", \"edit\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", \"create\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitch\", ctx_r3.mode);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.issue);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", \"edit\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", \"create\");\n  }\n}\n\nfunction IssuesViewInnerComponent_app_project_frame_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"app-project-frame\", 2);\n    i0.ɵɵtemplate(1, IssuesViewInnerComponent_app_project_frame_2_div_1_Template, 22, 16, \"div\", 3);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n\n    const _r0 = i0.ɵɵreference(1);\n\n    i0.ɵɵproperty(\"project\", ctx_r2.project);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.issues)(\"ngIfElse\", _r0);\n  }\n}\n\nexport let IssuesViewInnerComponent = /*#__PURE__*/(() => {\n  class IssuesViewInnerComponent extends Base {\n    constructor(router, issuesService, snackBar, projectService, dataService) {\n      super();\n      this.router = router;\n      this.issuesService = issuesService;\n      this.snackBar = snackBar;\n      this.projectService = projectService;\n      this.dataService = dataService;\n      this.mode = \"show\";\n    }\n\n    ngOnInit() {}\n\n    ngOnDestroy() {\n      this.unloadEpics(this.project);\n    }\n\n    loadEpics() {\n      if (!this.project) {\n        return;\n      }\n\n      this.dataService.load(`projects/${this.project.id}/epics`, [`projects/${this.project.id}/epics`, `projects/${this.project.id}/epics/*`]);\n      this.epics$ = this.dataService.values[`projects/${this.project.id}/epics`];\n      this.dataService.load(`projects/${this.project.id}/sprints?current=true`, [`projects/${this.project.id}/sprints`, `projects/${this.project.id}/sprints/*`]);\n      this.sprints$ = this.dataService.values[`projects/${this.project.id}/sprints?current=true`];\n    }\n\n    unloadEpics(p) {\n      if (!p) {\n        return;\n      }\n\n      this.dataService.unload(`projects/${p.id}/epics`, [`projects/${p.id}/epics`, `projects/${p.id}/epics/*`]);\n    }\n\n    set project(value) {\n      console.log(\"stop here\");\n\n      if (this._project) {\n        this.unloadEpics(this._project);\n      }\n\n      this._project = value;\n\n      if (this._project) {\n        this.loadEpics();\n      }\n    }\n\n    get project() {\n      return this._project;\n    }\n\n    set issue(value) {\n      this._issue = value;\n      this.mode = 'show';\n    }\n\n    get issue() {\n      return this._issue;\n    }\n\n    editIssue() {\n      this.mode = 'edit';\n    }\n\n    showDetail(issue) {\n      if (this.mode == 'show') {\n        this.router.navigate(['projects', this.project.id, 'backlog', issue.id]);\n      }\n    }\n\n    clearDetail() {\n      this.router.navigate(['projects', this.project.id, 'backlog']);\n    }\n\n    cancelEdit() {\n      this.mode = 'show';\n    }\n\n    confirmEdit(issue) {\n      this.mode = 'show';\n      callWithSnackBar(this.snackBar, this.issuesService.save(issue), ['Saving issue...', 'Issue saved', 'Error saving issue']);\n    }\n\n    createIssue() {\n      this.mode = \"create\"; // need to wait for the issue form to be added to the view.\n\n      this.createIssueComponent.changes.pipe(first()).subscribe(x => {\n        this.createIssueComponent.first.issue = {\n          id: -1,\n          title: '',\n          description: '',\n          estimate: 0,\n          project: this.project\n        };\n      });\n    }\n\n    saveNewIssue(issue) {\n      callWithSnackBar(this.snackBar, this.issuesService.createIssue(issue), ['Creating issue...', 'Issue created', 'Error creating issue']).subscribe(success => {\n        this.mode = \"show\";\n        this.router.navigate(['projects', this.project.id, 'backlog', success.id]);\n      });\n    }\n\n    onReorderIssues(reorderData) {\n      callWithSnackBar(this.snackBar, this.projectService.reorderIssues(this.project, reorderData.fromIndex, reorderData.toIndex), [\"Reordering Issues...\", \"Issues Reordered\", \"Error Reordering Issues\"]);\n    }\n\n    delete(issue) {\n      callWithSnackBar(this.snackBar, this.issuesService.deleteIssue(issue.id), [\"Deleting issue...\", \"Issue deleted\", \"Error deleting issue\"]).subscribe(success => {\n        this.mode = \"show\";\n        this.router.navigate(['projects', this.project.id, 'backlog']);\n      });\n    }\n\n    onCompleteIssue(issue) {\n      callWithSnackBar(this.snackBar, this.issuesService.markCompleted(issue.id), [\"Completing issue...\", \"Issue completed\", \"Error completing issue\"]);\n    }\n\n  }\n\n  IssuesViewInnerComponent.ɵfac = function IssuesViewInnerComponent_Factory(t) {\n    return new (t || IssuesViewInnerComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.IssuesService), i0.ɵɵdirectiveInject(i3.MatSnackBar), i0.ɵɵdirectiveInject(i4.ProjectService), i0.ɵɵdirectiveInject(i5.DataService));\n  };\n\n  IssuesViewInnerComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: IssuesViewInnerComponent,\n    selectors: [[\"sb-issues-view-inner\"]],\n    viewQuery: function IssuesViewInnerComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.createIssueComponent = _t);\n      }\n    },\n    inputs: {\n      issues: \"issues\",\n      project: \"project\",\n      issue: \"issue\"\n    },\n    features: [i0.ɵɵInheritDefinitionFeature],\n    decls: 3,\n    vars: 2,\n    consts: [[\"progressSpinner\", \"\"], [3, \"project\", 4, \"ngIf\", \"ngIfElse\"], [3, \"project\"], [4, \"ngIf\", \"ngIfElse\"], [\"cdkDropListGroup\", \"\", 1, \"row\"], [1, \"col-md-6\", 3, \"ngClass\"], [1, \"inner-detail-card\"], [1, \"col-12\", \"text-right\", \"p-0\"], [\"mat-button\", \"\", \"matTooltip\", \"New Issue\", 1, \"add-button\", \"icon-button\", 3, \"click\"], [1, \"mr-1\"], [\"allIssuesAllowed\", \"false\", 1, \"product-backlog\", 3, \"container\", \"issues\", \"fixed\", \"requestedIssueId\", \"issueSelected\"], [\"productBacklog\", \"\"], [\"class\", \"issue-div arrow-div col-12 small-only\", 4, \"ngIf\"], [1, \"col-md-6\"], [3, \"ngSwitch\"], [4, \"ngSwitchCase\"], [\"class\", \"banner-text pt-4\", 4, \"ngSwitchCase\"], [4, \"ngIf\"], [1, \"issue-div\", \"arrow-div\", \"col-12\", \"small-only\"], [\"mat-icon-button\", \"\", 1, \"arrow-button\", 3, \"click\"], [1, \"align-middle\"], [1, \"banner-text\", \"pt-4\"], [1, \"mr-1\", \"sb-icon\"], [3, \"showAcceptanceCriteria\", \"showCompletionCheckboxes\", \"issue\", \"epics\", \"sprints\", \"editIssue\", \"completeIssue\"], [\"mode\", \"edit\", 3, \"issue\", \"confirmEdit\", \"cancelEdit\", \"deleteIssue\", 4, \"ngSwitchCase\"], [\"mode\", \"edit\", 3, \"issue\", \"confirmEdit\", \"cancelEdit\", \"deleteIssue\"], [\"mode\", \"create\", 3, \"confirmEdit\", \"cancelEdit\"], [\"createIssue\", \"\"]],\n    template: function IssuesViewInnerComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, IssuesViewInnerComponent_ng_template_0_Template, 1, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵtemplate(2, IssuesViewInnerComponent_app_project_frame_2_Template, 2, 3, \"app-project-frame\", 1);\n      }\n\n      if (rf & 2) {\n        const _r0 = i0.ɵɵreference(1);\n\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.project)(\"ngIfElse\", _r0);\n      }\n    },\n    dependencies: [i6.NgClass, i6.NgIf, i6.NgSwitch, i6.NgSwitchCase, i7.MatCardContent, i7.MatCardTitle, i8.MatIcon, i9.MatButton, i10.MatTooltip, i11.MatSpinner, i12.CdkDropListGroup, i13.IssueDetailComponent, i14.ProjectFrameComponent, i15.IssueFormComponent, i16.SimpleIssuesListComponent, i6.AsyncPipe],\n    styles: [\".inner-detail-card[_ngcontent-%COMP%]{font-family:var(--banner-font);background-color:var(--background);color:var(--on-background)}.issue-div[_ngcontent-%COMP%]{margin:0 auto;border:1px solid var(--card-border);padding-left:4px;padding-top:2px;padding-bottom:2px;vertical-align:middle}\"]\n  });\n  return IssuesViewInnerComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}