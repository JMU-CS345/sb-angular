{"ast":null,"code":"import { EventEmitter, ElementRef } from '@angular/core';\nimport { Base } from '../base';\nimport { DataService } from '../data.service';\nimport { Observable } from 'rxjs';\nimport { FormControl } from '@angular/forms';\nimport { IssuesService } from '../issues.service';\nimport { EpicsService } from '../epics.service';\nimport { callWithSnackBar } from '../util';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { Router } from '@angular/router';\nimport { Color } from '../color';\nimport { MatDialog } from '@angular/material/dialog';\nimport { IssueFormDialogComponent } from '../issue-form-dialog/issue-form-dialog.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../data.service\";\nimport * as i2 from \"../issues.service\";\nimport * as i3 from \"@angular/material/snack-bar\";\nimport * as i4 from \"../epics.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"@angular/material/dialog\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"@angular/material/icon\";\nimport * as i9 from \"@angular/material/button\";\nimport * as i10 from \"@angular/material/tooltip\";\nimport * as i11 from \"@angular/material/progress-spinner\";\nimport * as i12 from \"../tshirt-size/tshirt-size.component\";\nimport * as i13 from \"../issue-list/issue-list.component\";\nimport * as i14 from \"../comment-display/comment-display.component\";\nimport * as i15 from \"../comment-entry/comment-entry.component\";\nconst _c0 = [\"issueInput\"];\n\nfunction EpicDetailComponent_ng_template_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-spinner\");\n  }\n}\n\nconst _c1 = function (a0) {\n  return {\n    \"color\": a0\n  };\n};\n\nfunction EpicDetailComponent_div_2_mat_icon_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-icon\", 25);\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"ngStyle\", i0.ɵɵpureFunction1(2, _c1, ctx_r3.epic.color))(\"matTooltip\", ctx_r3.epic.color);\n  }\n}\n\nfunction EpicDetailComponent_div_2_mat_icon_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-icon\", 26);\n  }\n}\n\nfunction EpicDetailComponent_div_2_sb_comment_display_35_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"sb-comment-display\", 27);\n  }\n\n  if (rf & 2) {\n    const comment_r6 = ctx.$implicit;\n    i0.ɵɵproperty(\"comment\", comment_r6);\n  }\n}\n\nconst _c2 = function (a0, a1) {\n  return {\n    \"background-color\": a0,\n    \"color\": a1\n  };\n};\n\nconst _c3 = function () {\n  return [];\n};\n\nconst _c4 = function (a0) {\n  return {\n    list: a0\n  };\n};\n\nconst _c5 = function (a0) {\n  return {\n    issues: a0\n  };\n};\n\nfunction EpicDetailComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 2)(2, \"div\", 3)(3, \"span\", 4);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"span\", 5);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 6)(8, \"button\", 7);\n    i0.ɵɵlistener(\"click\", function EpicDetailComponent_div_2_Template_button_click_8_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.onEditEpic());\n    });\n    i0.ɵɵelementStart(9, \"mat-icon\", 8);\n    i0.ɵɵtext(10, \"edit\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(11, \"p\", 9);\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"p\", 10);\n    i0.ɵɵelement(14, \"mat-icon\", 11);\n    i0.ɵɵtext(15, \" Size: \");\n    i0.ɵɵelement(16, \"sb-tshirt-size\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"p\", 10);\n    i0.ɵɵelement(18, \"mat-icon\", 13);\n    i0.ɵɵtext(19, \" Color: \");\n    i0.ɵɵtemplate(20, EpicDetailComponent_div_2_mat_icon_20_Template, 1, 4, \"mat-icon\", 14);\n    i0.ɵɵtemplate(21, EpicDetailComponent_div_2_mat_icon_21_Template, 1, 0, \"mat-icon\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"div\", 16)(23, \"div\", 17);\n    i0.ɵɵtext(24, \" Issues \");\n    i0.ɵɵelementStart(25, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function EpicDetailComponent_div_2_Template_button_click_25_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.createIssue(ctx_r9.epic));\n    });\n    i0.ɵɵelementStart(26, \"mat-icon\", 19);\n    i0.ɵɵtext(27, \"add_circle\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(28, \"div\")(29, \"sb-issue-list\", 20);\n    i0.ɵɵlistener(\"issueSelected\", function EpicDetailComponent_div_2_Template_sb_issue_list_issueSelected_29_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.onIssueSelected($event));\n    })(\"reorder\", function EpicDetailComponent_div_2_Template_sb_issue_list_reorder_29_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.onReorder($event));\n    })(\"issueRemoved\", function EpicDetailComponent_div_2_Template_sb_issue_list_issueRemoved_29_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.removeIssue($event));\n    });\n    i0.ɵɵpipe(30, \"async\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(31, \"div\", 21)(32, \"div\", 17);\n    i0.ɵɵtext(33, \"Comments\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(34, \"div\", 22);\n    i0.ɵɵtemplate(35, EpicDetailComponent_div_2_sb_comment_display_35_Template, 1, 1, \"sb-comment-display\", 23);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(36, \"sb-comment-entry\", 24);\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngStyle\", i0.ɵɵpureFunction2(13, _c2, ctx_r2.adaptiveBackgroundColor(ctx_r2.epic.color), ctx_r2.adaptiveFontColor(ctx_r2.epic.color)));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"#\", ctx_r2.epic.id, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.epic.title);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(ctx_r2.epic.description);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"size\", ctx_r2.epic.size);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.epic.color);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r2.epic.color);\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"issues\", (i0.ɵɵpipeBind1(30, 11, ctx_r2.epicIssues) || i0.ɵɵpureFunction1(19, _c5, i0.ɵɵpureFunction1(17, _c4, i0.ɵɵpureFunction0(16, _c3)))).issues.list)(\"allowRemove\", ctx_r2.permission(ctx_r2.epic, \"update\"));\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.epic.comments);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"epicId\", ctx_r2.epic.id);\n  }\n}\n\nexport let EpicDetailComponent = /*#__PURE__*/(() => {\n  class EpicDetailComponent extends Base {\n    constructor(dataService, issuesService, snackBar, epicsService, router, dialog) {\n      super();\n      this.dataService = dataService;\n      this.issuesService = issuesService;\n      this.snackBar = snackBar;\n      this.epicsService = epicsService;\n      this.router = router;\n      this.dialog = dialog;\n      this.issueControl = new FormControl();\n      this.showInput = false;\n      this.editEpic = new EventEmitter();\n      this.reorder = new EventEmitter();\n    }\n\n    ngOnInit() {}\n\n    set epic(value) {\n      if (this._epic) {\n        this.dataService.unload(`epics/${this._epic.id}/issues`, [`epics/${this._epic.id}/issues`, `epics/${this._epic.id}/issues/*`]);\n      }\n\n      this._epic = value;\n      this.dataService.load(`epics/${this._epic.id}/issues`, [`epics/${this._epic.id}/issues`, `epics/${this._epic.id}/issues/*`]);\n      this.epicIssues = this.dataService.values[`epics/${this._epic.id}/issues`];\n    }\n\n    get epic() {\n      return this._epic;\n    }\n\n    ngOnDestroy() {\n      if (this.epic) {\n        this.dataService.unload(`projects/${this.epic.project.id}/issues`, [`projects/${this.epic.project.id}/issues`, `projects/${this.epic.project.id}/issues/*`]);\n      }\n    }\n\n    onOptionSelected(event) {\n      let value = event.option.value;\n      this.epic.issues.push(value);\n      value.epic = this.epic;\n      let toSave = {\n        id: value.id,\n        epic_id: this.epic.id\n      };\n      callWithSnackBar(this.snackBar, this.epicsService.addIssue(this.epic.id, value), ['Adding Issue...', 'Issue Added', 'Error Adding Issue']);\n      this.issueInput.nativeElement.value = \"\";\n    }\n\n    issueLabel(option) {\n      return option ? option.title : '';\n    }\n\n    onIssueSelected(issue) {\n      this.router.navigate(['/projects', issue.project.id, 'backlog', issue.id]);\n    }\n\n    fontColor(color) {\n      return Color.fontColor(color);\n    }\n\n    adaptiveFontColor(color) {\n      if (!color) {\n        return 'var(--on-background)';\n      }\n\n      let fc = Color.fontColor(color);\n\n      if (fc == '#FFFFFF') {\n        return color;\n      }\n\n      return fc;\n    }\n\n    adaptiveBackgroundColor(color) {\n      if (!color) {\n        return 'var(--background)';\n      }\n\n      let fc = Color.fontColor(color);\n\n      if (fc == '#FFFFFF') {\n        return fc;\n      }\n\n      return color;\n    }\n\n    onEditEpic() {\n      this.editEpic.emit(this.epic);\n    }\n\n    createIssue(epic) {\n      let data = {\n        epic: epic\n      };\n      const dialogRef = this.dialog.open(IssueFormDialogComponent, {\n        maxWidth: \"800px\",\n        minWidth: \"80%\",\n        data: data\n      });\n      dialogRef.afterClosed().subscribe(dialogResult => {\n        if (dialogResult) {\n          callWithSnackBar(this.snackBar, this.issuesService.createIssue(dialogResult), ['Creating issue...', 'Created issue', 'Error creating issue']);\n        }\n      });\n    }\n\n    onReorder(reorderData) {\n      this.reorder.emit(reorderData);\n    }\n\n    removeIssue(issue) {\n      issue.epic = null;\n      callWithSnackBar(this.snackBar, this.epicsService.removeIssue(this.epic, issue), [\"Removing From Epic\", \"Removed\", \"Error While Removing\"]);\n    }\n\n  }\n\n  EpicDetailComponent.ɵfac = function EpicDetailComponent_Factory(t) {\n    return new (t || EpicDetailComponent)(i0.ɵɵdirectiveInject(i1.DataService), i0.ɵɵdirectiveInject(i2.IssuesService), i0.ɵɵdirectiveInject(i3.MatSnackBar), i0.ɵɵdirectiveInject(i4.EpicsService), i0.ɵɵdirectiveInject(i5.Router), i0.ɵɵdirectiveInject(i6.MatDialog));\n  };\n\n  EpicDetailComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: EpicDetailComponent,\n    selectors: [[\"app-epic-detail\"]],\n    viewQuery: function EpicDetailComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.issueInput = _t.first);\n      }\n    },\n    inputs: {\n      showEditButton: \"showEditButton\",\n      epic: \"epic\"\n    },\n    outputs: {\n      editEpic: \"editEpic\",\n      reorder: \"reorder\"\n    },\n    features: [i0.ɵɵInheritDefinitionFeature],\n    decls: 3,\n    vars: 2,\n    consts: [[\"progressSpinner\", \"\"], [4, \"ngIf\", \"ngIfElse\"], [1, \"row\", 3, \"ngStyle\"], [1, \"banner-text\", \"p-2\", \"col-10\", \"epic-banner\"], [1, \"epic-number\"], [1, \"epic-title\"], [1, \"col-2\", \"p-2\"], [\"mat-icon-button\", \"\", \"matTooltip\", \"Edit Epic\", 3, \"click\"], [1, \"sb-icon\"], [1, \"epic-description\", \"p-2\"], [1, \"banner-text\", \"pl-2\"], [\"fontSet\", \"fas\", \"fontIcon\", \"fa-tshirt\"], [1, \"base-text\", \"ml-1\", 3, \"size\"], [\"fontSet\", \"fas\", \"fontIcon\", \"fa-palette\"], [\"class\", \"ml-1\", \"fontSet\", \"fas\", \"fontIcon\", \"fa-circle\", 3, \"ngStyle\", \"matTooltip\", 4, \"ngIf\"], [\"class\", \"ml-1\", \"fontSet\", \"far\", \"fontIcon\", \"fa-circle\", \"matTooltip\", \"No Color Set\", 4, \"ngIf\"], [1, \"p-2\", \"issues-card\"], [1, \"banner-text\"], [\"mat-icon-button\", \"\", \"matTooltip\", \"Create issue\", 3, \"click\"], [1, \"add-issue-button\", \"sb-icon\"], [3, \"issues\", \"allowRemove\", \"issueSelected\", \"reorder\", \"issueRemoved\"], [1, \"mt-3\"], [1, \"comments-display-box\", \"mb-1\"], [3, \"comment\", 4, \"ngFor\", \"ngForOf\"], [3, \"epicId\"], [\"fontSet\", \"fas\", \"fontIcon\", \"fa-circle\", 1, \"ml-1\", 3, \"ngStyle\", \"matTooltip\"], [\"fontSet\", \"far\", \"fontIcon\", \"fa-circle\", \"matTooltip\", \"No Color Set\", 1, \"ml-1\"], [3, \"comment\"]],\n    template: function EpicDetailComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, EpicDetailComponent_ng_template_0_Template, 1, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵtemplate(2, EpicDetailComponent_div_2_Template, 37, 21, \"div\", 1);\n      }\n\n      if (rf & 2) {\n        const _r0 = i0.ɵɵreference(1);\n\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.epic)(\"ngIfElse\", _r0);\n      }\n    },\n    dependencies: [i7.NgForOf, i7.NgIf, i7.NgStyle, i8.MatIcon, i9.MatButton, i10.MatTooltip, i11.MatSpinner, i12.TshirtSizeComponent, i13.IssueListComponent, i14.CommentDisplayComponent, i15.CommentEntryComponent, i7.AsyncPipe],\n    styles: [\".epic-description[_ngcontent-%COMP%]{background-color:var(--background);color:var(--on-background);font-family:var(--text-font)}.current-option[_ngcontent-%COMP%]{font-size:small}.issue-input[_ngcontent-%COMP%]{font-family:var(--user-font)}.issues-card[_ngcontent-%COMP%]{background-color:var(--background);color:var(--on-background)}.add-issue-form[_ngcontent-%COMP%]{display:inline;width:100%}.add-issue[_ngcontent-%COMP%]{color:var(--on-background)}.comments-display-box[_ngcontent-%COMP%]{background-color:var(--background)}.epic-number[_ngcontent-%COMP%]{font-size:x-small;vertical-align:middle}.epic-title[_ngcontent-%COMP%]{font-size:x-large;vertical-align:middle}\"]\n  });\n  return EpicDetailComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}