<ng-template #progressSpinner><mat-spinner style="min-height: 32px;" diameter="32"></mat-spinner></ng-template>

<div style="border: solid 1px #CCC;">
	<mat-dialog-content style="margin: 8px;">
		<div *ngIf="project && project.team && (teamSummary | async); else progressSpinner">
			<mat-card class="user-summary-card" *ngFor="let user of (teamSummary | async).team.members">
				<div><img *ngIf="user.picture" class="user-picture" [src]="user.picture"> {{ user.displayName || (user.first_name + " " + user.last_name) }} </div>
				<div class="work-estimate">Total estimated work: {{user.work.work}} hours</div>
				<div *ngIf="user.work.assigned_issues.length > 0">
					<div>Assigned Work:</div>
					<ul>
						<li class="user-summary-card" *ngFor="let issue of user.work.assigned_issues">Issue #{{issue.id}} - {{issue.title}}
							<ul class="row" *ngFor="let task of issue.assigned_tasks">
								<li>
									Task #{{task.id}} - {{task.title}} - {{task.estimate}} hours
									<button *ngIf="editable && permission(task, 'update')" mat-icon-button color="primary" (click)="unassignTask(task)">
										<mat-icon fontSet="fas" fontIcon="fa-times-circle" matTooltip="Unassign"></mat-icon>
									</button>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</mat-card>
			<mat-card class="user-summary-card" *ngIf="(teamSummary | async).team.unassignedWork.unassigned_issues.length > 0">
				Unassigned Work:
				<ul>
					<li *ngFor="let issue of (teamSummary | async).team.unassignedWork.unassigned_issues">
						Issue #{{issue.id}} - {{issue.title}}
						<ul>
							<li *ngFor="let task of issue.unassigned_tasks" class="row">
								<span class="col-4">Task #{{task.id}} - {{task.title}} - {{task.estimate}} hours</span>
								<sb-user-selector *ngIf="editable && permission(task, 'update')" class="col-8" [team]="(teamSummary | async)?.team.members" [assignee]="task.assignee" (userSelected)="assignTask(task, $event)"></sb-user-selector> 
								<!-- <button mat-icon-button color="primary" (click)="assign_task(task)">
									<mat-icon style="font-size: 16px;" matTooltip="Assign">add_circle</mat-icon>
								</button> -->
							</li>
						</ul>
					</li>
				</ul>
			</mat-card>
		</div>
	</mat-dialog-content>
</div>
