<ng-template #progressSpinner><mat-spinner></mat-spinner></ng-template>

<div *ngIf="issue; else progressSpinner">
	<div class="row" [ngStyle]="{'background-color': adaptiveBackgroundColor(issue.epic?.color), 'color': adaptiveFontColor(issue.epic?.color)}">
		<div class="banner-text p-2 col-10 issue-banner">
			<span class="issue-number">#{{issue.id}} </span><span class="issue-title">{{issue.title}}</span>
		</div>
		<div class="col-2 p-2">
			<button mat-icon-button matTooltip="Edit Issue" (click)="onEditIssue()"><mat-icon class="sb-icon">edit</mat-icon></button>
		</div>
	</div>
	<p class="issue-description p-2">{{issue.description}}</p>
	<p class="menu-text"><mat-icon fontSet="fas" fontIcon="fa-ruler"></mat-icon> Estimate: <span class="base-text">{{issue.estimate}}</span></p>
	<p class="menu-text"><mat-icon fontSet="fas" fontIcon="fa-clipboard-list"></mat-icon> State: <span class="base-text">{{issue.state}}</span></p>

	<h6 class="menu-text">Epic</h6>
	<div *ngIf="issue.epic">
	    <div class="epic-card text-truncate banner-text" 
	       [ngStyle]="{'background-color': (issue.epic.color ? issue.epic.color : '#FFFFFF'), 'color': fontColor(issue.epic.color)}"
	       [routerLink]="['/projects', issue.project.id, 'epics', issue.epic.id]">
	       {{issue.epic.title}}
	    </div>
	</div>
	<div *ngIf="!issue.epic">
		No Epic
	</div>

	<mat-card class="mt-4 issue-card" *ngIf="showAcceptanceCriteria"> 
		<h6 class="menu-text">Acceptance Criteria</h6>
		<div>
			<div *ngFor="let criterion of issue.acceptance_criteria">
				<div class="mb-2">
					<sb-acceptance-criterion-entry [criterion]="criterion" [issue]="issue" [showCompletionCheckboxes]="showCompletionCheckboxes" [editable]="editable" (deleteAC)="deleteAC($event)"></sb-acceptance-criterion-entry>
				</div>
			</div>
			<div *ngIf="editable && permission(issue,'update')">
				<div class="row add-ac-wrapper">
					<button class="col-1" *ngIf="permission(issue, 'update')" mat-icon-button matTooltip="New Acceptance Criterion" (click)="createAC(newCriterion.value)" [disabled]="newCriterion.value.trim() == ''"><mat-icon class="add-ac sb-icon">add_circle</mat-icon></button>
					<textarea class="col-10 user-text issue-card" #newCriterion></textarea>
				</div>
			</div>
		</div>
	</mat-card>
	
	<h6 class="mt-4 menu-text">Tasks <button style="position: relative; top: -4px" *ngIf="editable && permission(issue, 'create-task')" mat-icon-button color="primary" matTooltip="New Task" (click)="createTask()"><mat-icon class="sb-icon">add_circle</mat-icon></button></h6>

	<ng-template #notasks><span class="base-text">No Tasks</span></ng-template>
	<div *ngIf="issue.tasks && issue.tasks.length > 0; else notasks">
		<app-tasks [issue]="issue"></app-tasks>
	</div>

	<div class="mt-3">
		<h6 class="menu-text">Comments</h6>
		<div class="comments-display-box mb-1"><sb-comment-display *ngFor="let comment of issue.comments" [comment]="comment"></sb-comment-display></div>
		<sb-comment-entry [issueId]="issue.id"></sb-comment-entry>
	</div>
</div>
